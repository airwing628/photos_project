<!doctype html> 
<html lang='en'>
<head>
	<title>Picture</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/stylesheet.css') }}">
    <script type="text/javascript" src="{{ url_for('static', filename='jquery/jquery.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='jquery/jquery-ui.min.js') }}"></script>
</head>
<body>
	<div id='container'>
		<div id='header'>

            <h1>Photo Dojo</h1>

			{% if 'email' not in session %}
                <div id="login_register">
                    <p>Login</p>
                    <form action="/login" method="POST">
                        <input class="input_fields" type="text" name="email" placeholder="email">
                        <input class="input_fields" type="password" name="password" placeholder="password">
                        <input class="submit_button" type="submit" value="submit">  
                    </form>
                    <a href="/register">Not a user? Register <span id="blue">here</span></a>
                </div>
            {% else %}
                <div id="welcome_cart">
                    <p>Welcome {{ session['first_name']}} &nbsp &nbsp | &nbsp &nbsp <a href="">Cart ( {{ session['total_items']}} )</a> &nbsp &nbsp | &nbsp &nbsp<a href="/logout">Logout</a></p>
                </div>

            {% endif %}
		</div>
		<div id="nav">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/category">Categories </a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/contact">Contact</a></li>
            </ul>
        </div> <!--end of nav-->
		<div id='body'>
			<div id='mainpic'> 
 				<img src="{{ photo['url'] }}"> 
			</div>

			<div id="user_interaction">

				<div id='row'>

<!-- 					<div id='likes'>
						<form action='/like' method='post'>
							<input type='submit' value='Like'>
						</form>  
					</div> -->

					<div id='price'>
						<p>Price: ${{ photo['price'] }}</p>
					</div>
					<form action='/add_to_cart/{{ photo['id'] }}' method='post'>
						<input type='submit' value='Add to Cart'>
					</form>

				</div> 

				{% if 'user_id' in session %}
					<div id='comments'> 
						<form id="comment_form" method='post'>
							<textarea rows="10" cols="34" name='comment'></textarea><br>
							<input class="submit_button" type='submit' value='Add comment'>
						</form>
					</div>

				{% else %}

					<p> Log in to add comments </p>

				{% endif %}

				<div id="comment_box">					
				</div>
			</div> <!-- end of user_interaction -->			
		</div>
	</div>

	<script type="text/javascript">

		$.get('/get_comments/index_json/{{ photo["id"] }}', function(res){
			console.log(res);
			html_str = "";
			for (var i = 0; i<res.comments.length; i++){
				html_str += "<p><span id='blue_name'>"+res.comments[i].first_name+" says ("+res.comments[i].created_at+"): </span>"+res.comments[i].comment+"</p><br>"
			};
			console.log(html_str);
			$("#comment_box").html(html_str);
		}, 'json');

		$('#comment_form').submit(function(){

			$.post('/insert_comment/index_json/{{ photo["id"] }}', $(this).serialize(), function(res){
				html_str = "";
				for (var i = 0; i<res.comments.length; i++){
					html_str += "<p><span id='blue_name'>"+res.comments[i].first_name+" says ("+res.comments[i].created_at+"): </span>"+res.comments[i].comment+"</p><br>"
				};
				console.log(html_str);
				$("#comment_box").html(html_str);

			}, 'json');

			return false;
		});

	</script>
</body>
</html>



